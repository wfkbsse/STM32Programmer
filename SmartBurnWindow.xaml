<Window x:Class="STM32Programmer.SmartBurnWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="智能自动烧录" 
        Icon="IC.png"
        Height="580" Width="950"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        Closing="Window_Closing"
        SizeChanged="Window_SizeChanged"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">
    
    <Window.Resources>
        <!-- 紧凑卡片样式 -->
        <Style x:Key="CompactCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.15" Color="#000000"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 统计数字样式 -->
        <Style x:Key="StatNumberStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>
        
        <!-- 进度条标签样式 -->
        <Style x:Key="ProgressLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="50"/>
        </Style>
    </Window.Resources>
    
    <!-- 主容器 - 圆角悬浮效果，使用LayoutTransform实现清晰缩放 -->
    <Border x:Name="MainBorder" CornerRadius="16" Background="#F0F2F5" BorderThickness="1" BorderBrush="#D0D0D0">
        <Border.LayoutTransform>
            <ScaleTransform x:Name="ContentScale" ScaleX="1" ScaleY="1"/>
        </Border.LayoutTransform>
        <Border.Effect>
            <DropShadowEffect BlurRadius="25" ShadowDepth="8" Opacity="0.35" Color="#000000"/>
        </Border.Effect>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
            
            <!-- 顶部标题栏 -->
            <Border Grid.Row="0" Background="#1A73E8" CornerRadius="16,16,0,0" Padding="16,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AutoFix" Width="26" Height="26" Foreground="White" VerticalAlignment="Center"/>
                        <TextBlock Text="智能自动烧录 - 工业模式" FontSize="16" FontWeight="Bold" Foreground="White" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <TextBlock x:Name="StatusText" Grid.Column="1" Text="运行中..." FontSize="13" Foreground="#FFFFFFCC" 
                             HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,16,0"/>
                    
                    <Button x:Name="StopButton" Grid.Column="2" Click="StopButton_Click"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Background="#F44336" Foreground="White" Height="30" Padding="14,0"
                          materialDesign:ButtonAssist.CornerRadius="15" BorderThickness="0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Stop" Width="16" Height="16" Margin="0,0,5,0"/>
                            <TextBlock Text="停止" FontWeight="Medium" FontSize="12"/>
                        </StackPanel>
                    </Button>
                    
                    <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="8,0,0,0">
                        <Button x:Name="MaximizeButton" Click="MaximizeButton_Click"
                              Style="{StaticResource MaterialDesignFlatButton}"
                              Foreground="White" Width="30" Height="30" Padding="0" ToolTip="最大化/还原">
                            <materialDesign:PackIcon x:Name="MaximizeIcon" Kind="WindowMaximize" Width="16" Height="16"/>
                        </Button>
                        <Button x:Name="CloseWindowButton" Click="CloseButton_Click"
                              Style="{StaticResource MaterialDesignFlatButton}"
                              Foreground="White" Width="30" Height="30" Padding="0" ToolTip="关闭窗口">
                            <materialDesign:PackIcon Kind="Close" Width="18" Height="18"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- 主内容区 -->
            <Grid Grid.Row="1" Margin="12,8,12,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- 左侧面板 - 使用Grid让日志区域自动填充 -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 统计卡片 -->
                    <Border Grid.Row="0" Style="{StaticResource CompactCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock x:Name="CompletedCountText" Text="0" Style="{StaticResource StatNumberStyle}" Foreground="#1976D2"/>
                                <TextBlock Text="完成" FontSize="11" HorizontalAlignment="Center" Foreground="#666666"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock x:Name="SuccessCountText" Text="0" Style="{StaticResource StatNumberStyle}" Foreground="#4CAF50"/>
                                <TextBlock Text="成功" FontSize="11" HorizontalAlignment="Center" Foreground="#666666"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock x:Name="FailedCountText" Text="0" Style="{StaticResource StatNumberStyle}" Foreground="#F44336"/>
                                <TextBlock Text="失败" FontSize="11" HorizontalAlignment="Center" Foreground="#666666"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- BOOT固件信息 -->
                    <Border Grid.Row="1" Style="{StaticResource CompactCardStyle}" Background="#FFF8E1">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <materialDesign:PackIcon Kind="Flash" Width="16" Height="16" Foreground="#FF9800"/>
                                <TextBlock Text="BOOT固件" FontWeight="Bold" FontSize="12" Foreground="#E65100" Margin="5,0,0,0"/>
                            </StackPanel>
                            <TextBlock x:Name="BootFirmwareText" Text="-" FontSize="11" FontWeight="Medium" TextTrimming="CharacterEllipsis"/>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="大小:" FontSize="10" Foreground="#888" Width="35"/>
                                <TextBlock x:Name="BootFileSizeText" Text="-" FontSize="10"/>
                                <TextBlock Text="地址:" FontSize="10" Foreground="#888" Margin="12,0,0,0" Width="35"/>
                                <TextBlock x:Name="BootAddressText" Text="0x08000000" FontSize="10" FontFamily="Consolas" Foreground="#1A73E8"/>
                            </StackPanel>
                            <TextBlock x:Name="BootModifiedText" Text="-" FontSize="9" Foreground="#AAA" Margin="0,2,0,0"/>
                            <TextBlock x:Name="BootFilePathText" Text="-" FontSize="8" Foreground="#BBB" TextTrimming="CharacterEllipsis" 
                                     ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- APP固件信息 -->
                    <Border Grid.Row="2" Style="{StaticResource CompactCardStyle}" Background="#E3F2FD">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <materialDesign:PackIcon Kind="Application" Width="16" Height="16" Foreground="#2196F3"/>
                                <TextBlock Text="APP固件" FontWeight="Bold" FontSize="12" Foreground="#0D47A1" Margin="5,0,0,0"/>
                            </StackPanel>
                            <TextBlock x:Name="AppFirmwareText" Text="-" FontSize="11" FontWeight="Medium" TextTrimming="CharacterEllipsis"/>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="大小:" FontSize="10" Foreground="#888" Width="35"/>
                                <TextBlock x:Name="AppFileSizeText" Text="-" FontSize="10"/>
                                <TextBlock Text="地址:" FontSize="10" Foreground="#888" Margin="12,0,0,0" Width="35"/>
                                <TextBlock x:Name="AppAddressText" Text="0x08010000" FontSize="10" FontFamily="Consolas" Foreground="#1A73E8"/>
                            </StackPanel>
                            <TextBlock x:Name="AppModifiedText" Text="-" FontSize="9" Foreground="#AAA" Margin="0,2,0,0"/>
                            <TextBlock x:Name="AppFilePathText" Text="-" FontSize="8" Foreground="#BBB" TextTrimming="CharacterEllipsis"
                                     ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 操作日志 - 自动填充剩余高度 -->
                    <Border Grid.Row="3" Style="{StaticResource CompactCardStyle}" Margin="4,4,4,4">
                        <DockPanel>
                            <Grid DockPanel.Dock="Top" Margin="0,0,0,6">
                                <TextBlock Text="操作日志" FontWeight="Medium" FontSize="12"/>
                                <Button x:Name="ClearLogButton" Click="ClearLogButton_Click"
                                      Style="{StaticResource MaterialDesignFlatButton}"
                                      HorizontalAlignment="Right" Height="20" Padding="6,0" FontSize="10">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Delete" Width="12" Height="12" Margin="0,0,3,0"/>
                                        <TextBlock Text="清除"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                            <Border BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Background="#FAFAFA">
                                <ScrollViewer x:Name="LogScrollViewer" VerticalScrollBarVisibility="Auto">
                                    <TextBlock x:Name="LogTextBlock" Text="" Padding="8" FontFamily="Consolas" FontSize="10" TextWrapping="Wrap"/>
                                </ScrollViewer>
                            </Border>
                        </DockPanel>
                    </Border>
                </Grid>
                
                <!-- 右侧面板 - 两个独立容器 -->
                <Grid Grid.Column="1" Margin="8,0,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 容器1: 状态指示区（上方） -->
                    <Border x:Name="StatusIndicatorBorder" Grid.Row="0" CornerRadius="12" Margin="4,4,4,4" Background="#E3F2FD">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.2" Color="#000000"/>
                        </Border.Effect>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <materialDesign:PackIcon x:Name="BigStatusIcon" Kind="Sync" 
                                                   Width="80" Height="80" HorizontalAlignment="Center"
                                                   Foreground="#1A73E8"/>
                            <TextBlock x:Name="BigStatusText" Text="等待芯片连接" 
                                     FontSize="28" FontWeight="Bold" HorizontalAlignment="Center" 
                                     Foreground="#1A73E8" Margin="0,12,0,0"/>
                            <TextBlock x:Name="BigStatusDetail" Text="请连接第一块电路板" 
                                     FontSize="16" HorizontalAlignment="Center" 
                                     Foreground="#666666" Margin="0,8,0,0"/>
                            <TextBlock x:Name="BoardCountText" Text="" 
                                     FontSize="48" FontWeight="Bold" HorizontalAlignment="Center" 
                                     Foreground="#1A73E8" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 容器2: 步骤指示器 + 进度条（下方） -->
                    <Border Grid.Row="1" CornerRadius="12" Margin="4,4,4,4" Background="#FAFAFA">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.15" Color="#000000"/>
                        </Border.Effect>
                        <StackPanel Margin="20,16">
                            <!-- 步骤指示器 -->
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 步骤1: 连接 -->
                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <Ellipse x:Name="Step1Circle" Width="28" Height="28" Fill="#E0E0E0" Stroke="#BDBDBD" StrokeThickness="2"/>
                                    <materialDesign:PackIcon x:Name="Step1Icon" Kind="Check" Width="16" Height="16" Foreground="White" 
                                                           HorizontalAlignment="Center" Margin="0,-22,0,0" Visibility="Collapsed"/>
                                    <TextBlock Text="连接" FontSize="10" HorizontalAlignment="Center" Margin="0,4,0,0" Foreground="#616161"/>
                                </StackPanel>
                                
                                <!-- 连接线1 -->
                                <Border x:Name="Line1" Grid.Column="1" Height="3" Background="#E0E0E0" VerticalAlignment="Center" Margin="0,0,0,14"/>
                                
                                <!-- 步骤2: BOOT -->
                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <Ellipse x:Name="Step2Circle" Width="28" Height="28" Fill="#E0E0E0" Stroke="#BDBDBD" StrokeThickness="2"/>
                                    <materialDesign:PackIcon x:Name="Step2Icon" Kind="Check" Width="16" Height="16" Foreground="White" 
                                                           HorizontalAlignment="Center" Margin="0,-22,0,0" Visibility="Collapsed"/>
                                    <TextBlock x:Name="Step2Text" Text="BOOT" FontSize="10" HorizontalAlignment="Center" Margin="0,4,0,0" Foreground="#616161"/>
                                </StackPanel>
                                
                                <!-- 连接线2 -->
                                <Border x:Name="Line2" Grid.Column="3" Height="3" Background="#E0E0E0" VerticalAlignment="Center" Margin="0,0,0,14"/>
                                
                                <!-- 步骤3: APP -->
                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <Ellipse x:Name="Step3Circle" Width="28" Height="28" Fill="#E0E0E0" Stroke="#BDBDBD" StrokeThickness="2"/>
                                    <materialDesign:PackIcon x:Name="Step3Icon" Kind="Check" Width="16" Height="16" Foreground="White" 
                                                           HorizontalAlignment="Center" Margin="0,-22,0,0" Visibility="Collapsed"/>
                                    <TextBlock x:Name="Step3Text" Text="APP" FontSize="10" HorizontalAlignment="Center" Margin="0,4,0,0" Foreground="#616161"/>
                                </StackPanel>
                                
                                <!-- 连接线3 -->
                                <Border x:Name="Line3" Grid.Column="5" Height="3" Background="#E0E0E0" VerticalAlignment="Center" Margin="0,0,0,14"/>
                                
                                <!-- 步骤4: 完成 -->
                                <StackPanel Grid.Column="6" HorizontalAlignment="Center">
                                    <Ellipse x:Name="Step4Circle" Width="28" Height="28" Fill="#E0E0E0" Stroke="#BDBDBD" StrokeThickness="2"/>
                                    <materialDesign:PackIcon x:Name="Step4Icon" Kind="Check" Width="16" Height="16" Foreground="White" 
                                                           HorizontalAlignment="Center" Margin="0,-22,0,0" Visibility="Collapsed"/>
                                    <TextBlock Text="完成" FontSize="10" HorizontalAlignment="Center" Margin="0,4,0,0" Foreground="#616161"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- 当前阶段文字 -->
                            <TextBlock x:Name="CurrentStepText" Text="等待连接..." FontSize="13" FontWeight="Medium" 
                                     HorizontalAlignment="Center" Foreground="#1A73E8" Margin="0,0,0,12"/>
                            
                            <!-- 立体进度条 -->
                            <Grid Height="32" Margin="0,4,0,0">
                                <!-- 外层阴影边框 -->
                                <Border CornerRadius="16" Background="#E0E0E0">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="4" ShadowDepth="2" Direction="270" Opacity="0.2" Color="#000000"/>
                                    </Border.Effect>
                                </Border>
                                <!-- 内凹效果背景 -->
                                <Border CornerRadius="16" Margin="2" Background="#F5F5F5">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="3" ShadowDepth="1" Direction="90" Opacity="0.15" Color="#000000"/>
                                    </Border.Effect>
                                </Border>
                                <!-- 进度条轨道 -->
                                <Border x:Name="ProgressTrack" CornerRadius="14" Margin="3" Background="#E3F2FD"/>
                                <!-- 进度条填充 -->
                                <Border x:Name="ProgressFill" CornerRadius="14" Margin="3" HorizontalAlignment="Left" Width="0">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#42A5F5" Offset="0"/>
                                            <GradientStop Color="#1976D2" Offset="0.5"/>
                                            <GradientStop Color="#1565C0" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="6" ShadowDepth="0" Opacity="0.4" Color="#1976D2"/>
                                    </Border.Effect>
                                </Border>
                                <!-- 进度百分比文字 -->
                                <TextBlock x:Name="ProgressText" Text="0%" FontSize="14" FontWeight="Bold" 
                                         HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#333333">
                                    <TextBlock.Effect>
                                        <DropShadowEffect BlurRadius="2" ShadowDepth="0" Opacity="0.3" Color="White"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                                <!-- 隐藏的原始进度条用于数据绑定 -->
                                <ProgressBar x:Name="CurrentProgressBar" Visibility="Hidden" Minimum="0" Maximum="100" Value="0"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                    
                    <!-- 隐藏的兼容性进度条 -->
                    <ProgressBar x:Name="BootProgressBar" Grid.Row="2" Visibility="Collapsed"/>
                    <ProgressBar x:Name="AppProgressBar" Grid.Row="2" Visibility="Collapsed"/>
                    <TextBlock x:Name="BootProgressText" Grid.Row="2" Visibility="Collapsed"/>
                    <TextBlock x:Name="AppProgressText" Grid.Row="2" Visibility="Collapsed"/>
                    
                    <!-- 隐藏的兼容性控件 -->
                    <TextBlock x:Name="CurrentStatusText" Visibility="Collapsed"/>
                    <TextBlock x:Name="CurrentDetailText" Visibility="Collapsed"/>
                    <materialDesign:PackIcon x:Name="CurrentStatusIcon" Visibility="Collapsed"/>
                </Grid>
            </Grid>
            
            <!-- 底部信息栏 -->
            <Border Grid.Row="2" Background="#FFFFFF" CornerRadius="0,0,16,16" Padding="16,8" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Clock" Width="14" Height="14" Foreground="#888888" VerticalAlignment="Center"/>
                        <TextBlock x:Name="ElapsedTimeText" Text="运行时间: 00:00:00" VerticalAlignment="Center" FontSize="11" Margin="5,0,0,0"/>
                        <TextBlock Text="|" Foreground="#CCCCCC" Margin="12,0" VerticalAlignment="Center"/>
                        <materialDesign:PackIcon Kind="Timer" Width="14" Height="14" Foreground="#888888" VerticalAlignment="Center"/>
                        <TextBlock x:Name="AverageTimeText" Text="平均: -- 秒/块" VerticalAlignment="Center" FontSize="11" Margin="5,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="成功率:" FontSize="11" Foreground="#888888" VerticalAlignment="Center"/>
                        <TextBlock x:Name="SuccessRateText" Text="--%" FontSize="12" FontWeight="Bold" Foreground="#4CAF50" VerticalAlignment="Center" Margin="5,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
